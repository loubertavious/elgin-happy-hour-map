map.on('load', () => {
  fetch('bars.geojson')
    .then(res => res.json())
    .then(data => {
      data.features.forEach(bar => {
        const coords = bar.geometry.coordinates;
        const props = bar.properties;

        // DEBUG: Log properties to console
        console.log(props);

        const color = getStatusColor(props.happyHourStart, props.happyHourEnd);

        const marker = document.createElement('div');
        marker.style.backgroundColor = color;
        marker.style.width = '20px';
        marker.style.height = '20px';
        marker.style.borderRadius = '50%';
        marker.style.border = '2px solid white';
        marker.style.boxShadow = '0 0 5px rgba(0,0,0,0.5)';

        new maplibregl.Marker(marker)
          .setLngLat(coords)
          .setPopup(new maplibregl.Popup({ offset: 25 })
            .setHTML(`<strong>${props.name || 'No Name'}</strong><br>
                      Happy Hour: ${props.happyHourStart || 'N/A'}â€“${props.happyHourEnd || 'N/A'}<br>
                      Deal: ${props.deal || 'N/A'}`))
          .addTo(map);
      });
    })
    .catch(err => console.error("Error loading bars.geojson:", err));
});
